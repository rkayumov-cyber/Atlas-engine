services:
  node-1:
    build: .
    container_name: atlas-node-1
    environment:
      - ATLAS_PORT=5000
      - ATLAS_DB=/data/state.db
    ports:
      - "5001:5000"
    volumes:
      - node1-data:/data

  node-2:
    build: .
    container_name: atlas-node-2
    environment:
      - ATLAS_PORT=5000
      - ATLAS_DB=/data/state.db
    ports:
      - "5002:5000"
    volumes:
      - node2-data:/data

  node-3:
    build: .
    container_name: atlas-node-3
    environment:
      - ATLAS_PORT=5000
      - ATLAS_DB=/data/state.db
    ports:
      - "5003:5000"
    volumes:
      - node3-data:/data

  miner:
    build: .
    container_name: atlas-miner
    command: ["python", "miner.py", "--all", "--interval", "5"]
    environment:
      - ATLAS_NODES=http://node-1:5000,http://node-2:5000,http://node-3:5000
    depends_on:
      - node-1
      - node-2
      - node-3

  explorer:
    image: nginx:alpine
    container_name: atlas-explorer
    ports:
      - "8080:80"
    volumes:
      - ./explorer/dashboard.html:/usr/share/nginx/html/index.html:ro
      - ./explorer/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - node-1
      - node-2
      - node-3

  monitor:
    image: nginx:alpine
    container_name: atlas-monitor
    ports:
      - "8090:80"
    volumes:
      - ./monitor/index.html:/usr/share/nginx/html/index.html:ro
      - ./monitor/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - node-1
      - node-2
      - node-3

volumes:
  node1-data:
  node2-data:
  node3-data:
